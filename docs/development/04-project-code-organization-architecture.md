# 04 - é¡¹ç›®ä»£ç ç»„ç»‡æ¶æ„æŒ‡å—

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **æ–‡æ¡£ç±»å‹**: é¡¹ç›®ä»£ç ç»„ç»‡æ¶æ„æŒ‡å—
- **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2024å¹´12æœˆ
- **æœ€åæ›´æ–°**: 2024å¹´12æœˆ
- **æ–‡æ¡£çŠ¶æ€**: å®æ–½ç‰ˆ
- **ç›®æ ‡è¯»è€…**: å…¨æ ˆå·¥ç¨‹å¸ˆã€æ¶æ„å¸ˆã€å¼€å‘å›¢é˜Ÿé¢†å¯¼

---

## ğŸ¯ è®¾è®¡ç†å¿µä¸ç›®æ ‡

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

æˆ‘ä»¬çš„é¡¹ç›®ä»£ç ç»„ç»‡éµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š

```
ğŸ›ï¸  Clean Architecture (åˆ†å±‚æ¶æ„)
    +
ğŸ¯  Domain-Driven Design (é¢†åŸŸé©±åŠ¨)
    +
ğŸ“¦  Monolith First (å•ä½“ä¼˜å…ˆ)
    +
ğŸš€  Microservice Ready (å¾®æœåŠ¡å°±ç»ª)
```

### æ¶æ„ç›®æ ‡

1. **ğŸ¯ æ»¡è¶³å•ä½“åº”ç”¨å¼€å‘**: åœ¨ä¸€ä¸ªä»£ç åº“ä¸­é«˜æ•ˆå¼€å‘å’Œç»´æŠ¤
2. **ğŸš€ ä¸ºå¾®æœåŠ¡æ¶æ„æ‰©å±•åšå¥½å‡†å¤‡**: æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œï¼Œä¾¿äºæœªæ¥æ‹†åˆ†
3. **ğŸ›ï¸ æ»¡è¶³Clean Architectureè¦æ±‚**: ä¸¥æ ¼çš„åˆ†å±‚å’Œä¾èµ–å…³ç³»
4. **ğŸ§  ä½“ç°DDDçš„é¢†åŸŸè¾¹ç•Œ**: ä»¥ä¸šåŠ¡é¢†åŸŸä¸ºæ ¸å¿ƒç»„ç»‡ä»£ç 

### è®¾è®¡ä»·å€¼

| ä»·å€¼ç»´åº¦     | å•ä½“åº”ç”¨é˜¶æ®µ              | å¾®æœåŠ¡é˜¶æ®µ                |
| ------------ | ------------------------- | ------------------------- |
| **å¼€å‘æ•ˆç‡** | âœ… ç»Ÿä¸€å¼€å‘ç¯å¢ƒï¼Œå¿«é€Ÿè¿­ä»£ | âœ… ç‹¬ç«‹éƒ¨ç½²ï¼Œå¹¶è¡Œå¼€å‘     |
| **å›¢é˜Ÿåä½œ** | âœ… é›†ä¸­å¼ä»£ç ç®¡ç†         | âœ… æŒ‰é¢†åŸŸåˆ†å·¥åä½œ         |
| **æŠ€æœ¯å€ºåŠ¡** | âœ… ç»Ÿä¸€æŠ€æœ¯æ ˆï¼Œæ˜“ç»´æŠ¤     | âœ… æŠ€æœ¯æ ˆå¤šæ ·åŒ–ï¼ŒæŒ‰éœ€é€‰æ‹© |
| **æ‰©å±•æ€§**   | âš ï¸ å‚ç›´æ‰©å±•ä¸ºä¸»           | âœ… æ°´å¹³æ‰©å±•ï¼ŒæŒ‰éœ€ä¼¸ç¼©     |

---

## ğŸ“ æ•´ä½“é¡¹ç›®ç»“æ„

### é¡¶å±‚ç›®å½•æ¶æ„

```
aiofix-iam/
â”œâ”€â”€ apps/                          # ğŸ¯ åº”ç”¨ç¨‹åºç›®å½•
â”‚   â””â”€â”€ api/                       # åç«¯APIåº”ç”¨ï¼ˆå•ä½“åº”ç”¨å…¥å£ï¼‰
â”œâ”€â”€ libs/                          # ğŸ“š å…±äº«åº“ç›®å½•
â”‚   â”œâ”€â”€ domain/                    # ğŸ§  é¢†åŸŸæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ shared/                # å…±äº«é¢†åŸŸæ¨¡å—
â”‚   â”‚   â””â”€â”€ iam/                   # IAMé¢†åŸŸæ¨¡å—
â”‚   â””â”€â”€ infrastructure/            # ğŸ› ï¸ åŸºç¡€è®¾æ–½æ¨¡å—
â”‚       â”œâ”€â”€ cache/                 # ç¼“å­˜åŸºç¡€è®¾æ–½
â”‚       â”œâ”€â”€ config/                # é…ç½®åŸºç¡€è®¾æ–½
â”‚       â”œâ”€â”€ database/              # æ•°æ®åº“åŸºç¡€è®¾æ–½
â”‚       â”œâ”€â”€ logging/               # æ—¥å¿—åŸºç¡€è®¾æ–½
â”‚       â””â”€â”€ security/              # å®‰å…¨åŸºç¡€è®¾æ–½
â”œâ”€â”€ docs/                          # ğŸ“– æ–‡æ¡£ç›®å½•
â”œâ”€â”€ docker/                        # ğŸ³ Dockeré…ç½®
â”œâ”€â”€ scripts/                       # ğŸ”§ è„šæœ¬å·¥å…·
â””â”€â”€ tools/                         # ğŸ› ï¸ å¼€å‘å·¥å…·
```

### è®¾è®¡æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å•ä½“åº”ç”¨ (apps/api)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    è¡¨ç°å±‚ (Controllers)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       åº”ç”¨å±‚ (Use Cases)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ IAM Module  â”‚ Notificationâ”‚ Workflow    â”‚ Analytics & Others  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 é¢†åŸŸå±‚ (libs/domain)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          DDD å­é¢†åŸŸæ¨¡å— (æŒ‰ä¸šåŠ¡è¾¹ç•Œç»„ç»‡)                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚    tenant   â”‚    user     â”‚ organizationâ”‚ department  â”‚   â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚   â”‚
â”‚  â”‚  â”‚    role     â”‚ permission  â”‚    auth     â”‚   shared    â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            åŸºç¡€è®¾æ–½å±‚ (libs/infrastructure)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚  Cache  â”‚ Databaseâ”‚ Logging â”‚ Config  â”‚ Security & More â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Apps ç›®å½•ï¼šå•ä½“åº”ç”¨å…¥å£

### apps/api ç»“æ„

```
apps/api/
â”œâ”€â”€ src/                           # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.ts                    # ğŸš€ åº”ç”¨å¯åŠ¨å…¥å£
â”‚   â”œâ”€â”€ app.module.ts              # ğŸ—ï¸ æ ¹æ¨¡å—
â”‚   â”œâ”€â”€ app.controller.ts          # ğŸŒ æ ¹æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ app.service.ts             # âš™ï¸ æ ¹æœåŠ¡
â”‚   â”œâ”€â”€ config-test.service.ts     # ğŸ”§ é…ç½®æµ‹è¯•æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ shared/                    # ğŸ”„ åº”ç”¨çº§å…±äº«æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ guards/                # ğŸ›¡ï¸ å®ˆå«
â”‚   â”‚   â”œâ”€â”€ interceptors/          # ğŸ” æ‹¦æˆªå™¨
â”‚   â”‚   â”œâ”€â”€ pipes/                 # ğŸ”§ ç®¡é“
â”‚   â”‚   â”œâ”€â”€ filters/               # ğŸš« å¼‚å¸¸è¿‡æ»¤å™¨
â”‚   â”‚   â””â”€â”€ decorators/            # ğŸ¨ è£…é¥°å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ iam/                       # ğŸ” IAMé¢†åŸŸå…¥å£æ¨¡å—
â”‚   â”œâ”€â”€ notification/              # ğŸ“§ é€šçŸ¥é¢†åŸŸå…¥å£æ¨¡å—
â”‚   â”œâ”€â”€ workflow/                  # âš¡ å·¥ä½œæµé¢†åŸŸå…¥å£æ¨¡å—
â”‚   â”œâ”€â”€ analytics/                 # ğŸ“Š æ•°æ®åˆ†æé¢†åŸŸå…¥å£æ¨¡å—
â”‚   â”œâ”€â”€ image-management/          # ğŸ–¼ï¸ å›¾ç‰‡ç®¡ç†é¢†åŸŸå…¥å£æ¨¡å—
â”‚   â”œâ”€â”€ document-management/       # ğŸ“„ æ–‡æ¡£ç®¡ç†é¢†åŸŸå…¥å£æ¨¡å—
â”‚   â”œâ”€â”€ security-compliance/       # ğŸ”’ å®‰å…¨åˆè§„æ¨¡å—
â”‚   â”œâ”€â”€ monitoring-operations/     # ğŸ“ˆ ç›‘æ§è¿ç»´æ¨¡å—
â”‚   â”œâ”€â”€ api-integration/           # ğŸ”— APIé›†æˆæ¨¡å—
â”‚   â””â”€â”€ llm-management/            # ğŸ¤– LLMç®¡ç†æ¨¡å—
â”‚
â”œâ”€â”€ test/                          # ğŸ§ª æµ‹è¯•ç›®å½•
â”œâ”€â”€ dist/                          # ğŸ“¦ æ„å»ºè¾“å‡ºç›®å½•
â”œâ”€â”€ nest-cli.json                  # âš™ï¸ NestJS CLIé…ç½®
â”œâ”€â”€ tsconfig.json                  # ğŸ“ TypeScripté…ç½®
â”œâ”€â”€ .swcrc                         # âš¡ SWCæ„å»ºé…ç½®
â””â”€â”€ package.json                   # ğŸ“‹ ä¾èµ–é…ç½®
```

### å•ä½“åº”ç”¨çš„ä¼˜åŠ¿

1. **ğŸš€ å¿«é€Ÿå¯åŠ¨**: å•ä¸€å…¥å£ç‚¹ï¼Œç®€åŒ–éƒ¨ç½²å’Œè¿ç»´
2. **ğŸ”§ ç»Ÿä¸€é…ç½®**: é›†ä¸­çš„é…ç½®ç®¡ç†å’Œç¯å¢ƒå˜é‡
3. **ğŸ› è°ƒè¯•æ–¹ä¾¿**: å®Œæ•´çš„è°ƒç”¨é“¾è·¯ï¼Œä¾¿äºé—®é¢˜å®šä½
4. **ğŸ”„ äº‹åŠ¡å®Œæ•´**: æ”¯æŒè·¨æ¨¡å—çš„æ•°æ®åº“äº‹åŠ¡
5. **ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–**: å‡å°‘ç½‘ç»œè°ƒç”¨å¼€é”€

---

## ğŸ“š Libs ç›®å½•ï¼šæ¨¡å—åŒ–è®¾è®¡

### è®¾è®¡ç†å¿µ

```
ğŸ§  domain/     â† ä¸šåŠ¡æ ¸å¿ƒï¼Œä¸ä¾èµ–æŠ€æœ¯å®ç°
ğŸ› ï¸ infrastructure/ â† æŠ€æœ¯å®ç°ï¼Œæ”¯æ’‘ä¸šåŠ¡è¿è¡Œ
```

### libs/domain é¢†åŸŸæ¨¡å—

#### ç›®å½•ç»“æ„è®¾è®¡

```
libs/domain/
â”œâ”€â”€ shared/                        # ğŸ”„ å…±äº«é¢†åŸŸæ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ base/                  # åŸºç¡€æŠ½è±¡ç±»
â”‚   â”‚   â”œâ”€â”€ types/                 # é€šç”¨ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ interfaces/            # é€šç”¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ exceptions/            # å¼‚å¸¸ä½“ç³»
â”‚   â”‚   â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ .swcrc
â”‚
â””â”€â”€ iam/                           # ğŸ” IAMé¢†åŸŸæ¨¡å—
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ tenant/                # ğŸ¢ ç§Ÿæˆ·å­é¢†åŸŸ
    â”‚   â”‚   â”œâ”€â”€ domain/            # é¢†åŸŸå±‚
    â”‚   â”‚   â”‚   â”œâ”€â”€ entities/      # å®ä½“
    â”‚   â”‚   â”‚   â”œâ”€â”€ value-objects/ # å€¼å¯¹è±¡
    â”‚   â”‚   â”‚   â”œâ”€â”€ events/        # é¢†åŸŸäº‹ä»¶
    â”‚   â”‚   â”‚   â”œâ”€â”€ services/      # é¢†åŸŸæœåŠ¡
    â”‚   â”‚   â”‚   â””â”€â”€ repositories/  # ä»“å‚¨æ¥å£
    â”‚   â”‚   â”œâ”€â”€ application/       # åº”ç”¨å±‚
    â”‚   â”‚   â”‚   â”œâ”€â”€ use-cases/     # ç”¨ä¾‹
    â”‚   â”‚   â”‚   â”œâ”€â”€ commands/      # å‘½ä»¤
    â”‚   â”‚   â”‚   â”œâ”€â”€ queries/       # æŸ¥è¯¢
    â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/      # å¤„ç†å™¨
    â”‚   â”‚   â”‚   â””â”€â”€ dtos/          # æ•°æ®ä¼ è¾“å¯¹è±¡
    â”‚   â”‚   â””â”€â”€ presentation/      # è¡¨ç°å±‚
    â”‚   â”‚       â””â”€â”€ controllers/   # æ§åˆ¶å™¨
    â”‚   â”‚
    â”‚   â”œâ”€â”€ user/                  # ğŸ‘¤ ç”¨æˆ·å­é¢†åŸŸ
    â”‚   â”œâ”€â”€ organization/          # ğŸ›ï¸ ç»„ç»‡å­é¢†åŸŸ
    â”‚   â”œâ”€â”€ department/            # ğŸ¢ éƒ¨é—¨å­é¢†åŸŸ
    â”‚   â”œâ”€â”€ role/                  # ğŸ‘” è§’è‰²å­é¢†åŸŸ
    â”‚   â”œâ”€â”€ permission/            # ğŸ”‘ æƒé™å­é¢†åŸŸ
    â”‚   â””â”€â”€ auth/                  # ğŸ” è®¤è¯å­é¢†åŸŸ
    â”‚
    â”œâ”€â”€ package.json
    â”œâ”€â”€ tsconfig.json
    â””â”€â”€ .swcrc
```

#### DDDå­é¢†åŸŸä¼˜å…ˆåŸåˆ™

**âœ… æ­£ç¡®çš„ç»„ç»‡æ–¹å¼ï¼ˆä¸šåŠ¡ä¼˜å…ˆï¼‰**:

```
iam/src/
â”œâ”€â”€ user/                      # å­é¢†åŸŸè¾¹ç•Œæ¸…æ™°
â”‚   â”œâ”€â”€ domain/                # ç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ application/           # ç”¨æˆ·çš„åº”ç”¨æœåŠ¡
â”‚   â””â”€â”€ presentation/          # ç”¨æˆ·çš„APIæ¥å£
â””â”€â”€ tenant/                    # å¦ä¸€ä¸ªå­é¢†åŸŸ
    â”œâ”€â”€ domain/
    â”œâ”€â”€ application/
    â””â”€â”€ presentation/
```

**âŒ é”™è¯¯çš„ç»„ç»‡æ–¹å¼ï¼ˆæŠ€æœ¯ä¼˜å…ˆï¼‰**:

```
iam/src/
â”œâ”€â”€ domain/                    # æŠ€æœ¯åˆ†å±‚ï¼Œé¢†åŸŸè¾¹ç•Œæ¨¡ç³Š
â”‚   â”œâ”€â”€ user/
â”‚   â””â”€â”€ tenant/
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ user/
â”‚   â””â”€â”€ tenant/
â””â”€â”€ presentation/
    â”œâ”€â”€ user/
    â””â”€â”€ tenant/
```

### libs/infrastructure åŸºç¡€è®¾æ–½æ¨¡å—

#### ç›®å½•ç»“æ„

```
libs/infrastructure/
â”œâ”€â”€ cache/                         # ğŸ—„ï¸ ç¼“å­˜åŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ cache.module.ts        # ç¼“å­˜æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ services/              # ç¼“å­˜æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ redis-cache.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ memory-cache.service.ts
â”‚   â”‚   â”œâ”€â”€ factories/             # å·¥å‚ç±»
â”‚   â”‚   â”œâ”€â”€ decorators/            # è£…é¥°å™¨
â”‚   â”‚   â”œâ”€â”€ interceptors/          # æ‹¦æˆªå™¨
â”‚   â”‚   â””â”€â”€ interfaces/            # æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ .swcrc
â”‚
â”œâ”€â”€ config/                        # âš™ï¸ é…ç½®åŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config.module.ts       # é…ç½®æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ lib/                   # é…ç½®åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ database.config.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ redis.config.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.config.ts
â”‚   â”‚   â”‚   â””â”€â”€ app.config.ts
â”‚   â”‚   â””â”€â”€ services/              # é…ç½®æœåŠ¡
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ .swcrc
â”‚
â”œâ”€â”€ database/                      # ğŸ—ƒï¸ æ•°æ®åº“åŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ database.module.ts     # æ•°æ®åº“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ mikro-orm/             # MikroORMé…ç½®
â”‚   â”‚   â”œâ”€â”€ migrations/            # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â””â”€â”€ seeders/               # æ•°æ®å¡«å……
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ .swcrc
â”‚
â”œâ”€â”€ logging/                       # ğŸ“‹ æ—¥å¿—åŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ logging.module.ts      # æ—¥å¿—æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ services/              # æ—¥å¿—æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ pino-logger.service.ts
â”‚   â”‚   â””â”€â”€ middleware/            # ä¸­é—´ä»¶
â”‚   â”‚       â””â”€â”€ pino-logging.middleware.ts
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ .swcrc
â”‚
â””â”€â”€ security/                      # ğŸ”’ å®‰å…¨åŸºç¡€è®¾æ–½
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ security.module.ts     # å®‰å…¨æ¨¡å—
    â”‚   â”œâ”€â”€ auth/                  # è®¤è¯æœåŠ¡
    â”‚   â”œâ”€â”€ encryption/            # åŠ å¯†æœåŠ¡
    â”‚   â””â”€â”€ guards/                # å®‰å…¨å®ˆå«
    â”œâ”€â”€ package.json
    â”œâ”€â”€ tsconfig.json
    â””â”€â”€ .swcrc
```

---

## ğŸ—ï¸ Clean Architecture å®æ–½

### åˆ†å±‚ä¾èµ–å…³ç³»

```
ğŸ“± Presentation Layer (apps/api/src/{domain}/controllers)
    â†“ ä¾èµ–
ğŸ’¼ Application Layer (libs/domain/{domain}/application)
    â†“ ä¾èµ–
ğŸ§  Domain Layer (libs/domain/{domain}/domain)
    â†‘ æ¥å£å®ç°
ğŸ› ï¸ Infrastructure Layer (libs/infrastructure)
```

### ä¾èµ–å€’ç½®åŸåˆ™

#### âœ… æ­£ç¡®çš„ä¾èµ–å…³ç³»

```typescript
// libs/domain/iam/src/user/domain/repositories/user-repository.interface.ts
export interface UserRepository {
  save(user: User): Promise<void>;
  findById(id: Uuid): Promise<User | null>;
}

// libs/domain/iam/src/user/application/use-cases/create-user.use-case.ts
@Injectable()
export class CreateUserUseCase {
  constructor(
    private readonly userRepository: UserRepository, // ä¾èµ–æŠ½è±¡
  ) {}
}

// libs/infrastructure/database/src/repositories/user.repository.impl.ts
@Injectable()
export class UserRepositoryImpl implements UserRepository {
  // å®ç°æŠ½è±¡
  // å…·ä½“å®ç°...
}
```

#### âŒ é”™è¯¯çš„ä¾èµ–å…³ç³»

```typescript
// âŒ åº”ç”¨å±‚ç›´æ¥ä¾èµ–åŸºç¡€è®¾æ–½å®ç°
import { UserRepositoryImpl } from '@libs/infrastructure/database';

@Injectable()
export class CreateUserUseCase {
  constructor(
    private readonly userRepository: UserRepositoryImpl, // ç›´æ¥ä¾èµ–å®ç°
  ) {}
}
```

### åˆ†å±‚èŒè´£è¯´æ˜

| å±‚æ¬¡           | èŒè´£                               | ä¸å…è®¸çš„ä¾èµ–       | å…è®¸çš„ä¾èµ– |
| -------------- | ---------------------------------- | ------------------ | ---------- |
| **è¡¨ç°å±‚**     | HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€å“åº”æ ¼å¼åŒ– | é¢†åŸŸå±‚ã€åŸºç¡€è®¾æ–½å±‚ | åº”ç”¨å±‚     |
| **åº”ç”¨å±‚**     | ä¸šåŠ¡æµç¨‹ç¼–æ’ã€äº‹åŠ¡åè°ƒã€æƒé™æ£€æŸ¥   | è¡¨ç°å±‚ã€åŸºç¡€è®¾æ–½å±‚ | é¢†åŸŸå±‚     |
| **é¢†åŸŸå±‚**     | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€ä¸šåŠ¡è§„åˆ™ã€é¢†åŸŸæ¨¡å‹   | ä»»ä½•å¤–éƒ¨å±‚         | æ—          |
| **åŸºç¡€è®¾æ–½å±‚** | æ•°æ®å­˜å‚¨ã€å¤–éƒ¨æœåŠ¡ã€æŠ€æœ¯å®ç°       | æ— é™åˆ¶             | é¢†åŸŸå±‚æ¥å£ |

---

## ğŸš€ å•ä½“åˆ°å¾®æœåŠ¡æ¼”è¿›ç­–ç•¥

### ç¬¬ä¸€é˜¶æ®µï¼šå•ä½“åº”ç”¨ï¼ˆå½“å‰ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        apps/api                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     IAM      â”‚ Notification â”‚ Workflow â”‚ Analytics â”‚ Others â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   libs/domain                                â”‚  â”‚
â”‚  â”‚     â”œâ”€ iam/   â”œâ”€ notification/   â”œâ”€ workflow/   â”œâ”€ analytics/ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 libs/infrastructure                          â”‚  â”‚
â”‚  â”‚   â”œâ”€ database/  â”œâ”€ cache/  â”œâ”€ logging/  â”œâ”€ security/         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹ç‚¹**:

- âœ… å•ä¸€éƒ¨ç½²å•å…ƒ
- âœ… ç»Ÿä¸€æ•°æ®åº“äº‹åŠ¡
- âœ… ç®€åŒ–çš„å¼€å‘å’Œè°ƒè¯•
- âœ… é™ä½è¿ç»´å¤æ‚åº¦

### ç¬¬äºŒé˜¶æ®µï¼šå¾®æœåŠ¡åŒ–å‡†å¤‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Gateway                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    apps/api                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  IAM Module â”‚ Notificationâ”‚  Workflow   â”‚ Analytics & Others  â”‚ â”‚
â”‚ â”‚      â”‚      â”‚     â”‚       â”‚      â”‚      â”‚          â”‚         â”‚ â”‚
â”‚ â”‚      â–¼      â”‚     â–¼       â”‚      â–¼      â”‚          â–¼         â”‚ â”‚
â”‚ â”‚ libs/domain â”‚ libs/domain â”‚ libs/domain â”‚    libs/domain     â”‚ â”‚
â”‚ â”‚    /iam     â”‚/notificationâ”‚  /workflow  â”‚    /analytics      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å‡†å¤‡å·¥ä½œ**:

- ğŸ¯ å®Œå–„æ¨¡å—è¾¹ç•Œå®šä¹‰
- ğŸ“Š å»ºç«‹æ¨¡å—é—´é€šä¿¡åè®®
- ğŸ”„ å®ç°äº‹ä»¶é©±åŠ¨æ¶æ„
- ğŸ“‹ æ ‡å‡†åŒ–APIæ¥å£

### ç¬¬ä¸‰é˜¶æ®µï¼šæ¸è¿›å¼æ‹†åˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Gateway                                â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IAM Service  â”‚ â”‚Notificationâ”‚ â”‚ Workflow  â”‚ â”‚   Analytics &        â”‚
â”‚              â”‚ â”‚  Service   â”‚ â”‚ Service   â”‚ â”‚   Other Services     â”‚
â”‚ libs/domain/ â”‚ â”‚libs/domain/â”‚ â”‚libs/domain/â”‚ â”‚                      â”‚
â”‚    iam       â”‚ â”‚notificationâ”‚ â”‚  workflow â”‚ â”‚   (å¾…æ‹†åˆ†)              â”‚
â”‚              â”‚ â”‚            â”‚ â”‚           â”‚ â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‹†åˆ†ç­–ç•¥**:

- ğŸ¯ æŒ‰é¢†åŸŸè¾¹ç•Œæ‹†åˆ†
- ğŸ“Š åŸºäºä¸šåŠ¡ä»·å€¼ä¼˜å…ˆçº§
- ğŸ”„ ä¿æŒæ•°æ®ä¸€è‡´æ€§
- ğŸ“‹ æ¸è¿›å¼è¿ç§»

### ç¬¬å››é˜¶æ®µï¼šå®Œå…¨å¾®æœåŠ¡åŒ–

```
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚          API Gateway            â”‚
                  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ–¼â”€â”€â” â”Œâ–¼â”€â”€â” â”Œâ–¼â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  IAM Service   â”‚ â”‚ N â”‚ â”‚ W â”‚ â”‚ A â”‚ â”‚  Others  â”‚
        â”‚                â”‚ â”‚ o â”‚ â”‚ o â”‚ â”‚ n â”‚ â”‚          â”‚
        â”‚ User â”‚ Tenant  â”‚ â”‚ t â”‚ â”‚ r â”‚ â”‚ a â”‚ â”‚  Image   â”‚
        â”‚ Role â”‚ Org     â”‚ â”‚ i â”‚ â”‚ k â”‚ â”‚ l â”‚ â”‚  Doc     â”‚
        â”‚ Auth â”‚ Perm    â”‚ â”‚ f â”‚ â”‚ f â”‚ â”‚ y â”‚ â”‚  LLM     â”‚
        â”‚      â”‚ Dept    â”‚ â”‚ i â”‚ â”‚ l â”‚ â”‚ t â”‚ â”‚  Cache   â”‚
        â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ c â”‚ â”‚ o â”‚ â”‚ i â”‚ â”‚  ...     â”‚
                           â”‚ a â”‚ â”‚ w â”‚ â”‚ c â”‚ â”‚          â”‚
                           â”‚ t â”‚ â”‚   â”‚ â”‚ s â”‚ â”‚          â”‚
                           â”‚ i â”‚ â”‚   â”‚ â”‚   â”‚ â”‚          â”‚
                           â”‚ o â”‚ â”‚   â”‚ â”‚   â”‚ â”‚          â”‚
                           â”‚ n â”‚ â”‚   â”‚ â”‚   â”‚ â”‚          â”‚
                           â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æœ€ç»ˆæ¶æ„**:

- âœ… ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
- âœ… æŠ€æœ¯æ ˆå¤šæ ·åŒ–
- âœ… å›¢é˜Ÿè‡ªæ²»å¼€å‘
- âœ… é«˜å¯ç”¨å’Œå®¹é”™

---

## ğŸ“Š æ¨¡å—ä¾èµ–ç®¡ç†

### å½“å‰ä¾èµ–å…³ç³»

```typescript
// pnpm-workspace.yaml
packages:
  - "apps/*"
  - "libs/*"
  - "libs/domain/*"
  - "libs/infrastructure/*"

// apps/api/package.json
{
  "dependencies": {
    "@aiofix/domain-iam": "workspace:*",
    "@aiofix/domain-shared": "workspace:*",
    "@aiofix/infrastructure-cache": "workspace:*",
    "@aiofix/infrastructure-config": "workspace:*",
    "@aiofix/infrastructure-database": "workspace:*",
    "@aiofix/infrastructure-logging": "workspace:*",
    "@aiofix/infrastructure-security": "workspace:*"
  }
}

// libs/domain/iam/package.json
{
  "dependencies": {
    "@aiofix/domain-shared": "workspace:*"
  }
}
```

### ä¾èµ–åŸåˆ™

1. **ğŸ“¦ Apps å±‚**: å¯ä»¥ä¾èµ–æ‰€æœ‰ libs æ¨¡å—
2. **ğŸ§  Domain å±‚**: åªèƒ½ä¾èµ– domain/sharedï¼Œä¸èƒ½ä¾èµ– infrastructure
3. **ğŸ› ï¸ Infrastructure å±‚**: å¯ä»¥ä¾èµ– domain å±‚æ¥å£ï¼Œå®ç°å…·ä½“æŠ€æœ¯
4. **ğŸ”„ åŒçº§æ¨¡å—**: domain æ¨¡å—é—´å¯ä»¥ç›¸äº’ä¾èµ–ï¼Œä½†éœ€è¦é¿å…å¾ªç¯ä¾èµ–

### å¾ªç¯ä¾èµ–é¢„é˜²

```typescript
// âœ… æ­£ç¡®ï¼šé€šè¿‡å…±äº«æ¥å£é¿å…å¾ªç¯ä¾èµ–
// libs/domain/shared/src/interfaces/event-bus.interface.ts
export interface IEventBus {
  publish(event: DomainEvent): Promise<void>;
}

// libs/domain/iam/src/user/domain/entities/user.entity.ts
export class User {
  // é€šè¿‡å…±äº«æ¥å£å‘å¸ƒäº‹ä»¶ï¼Œä¸ç›´æ¥ä¾èµ–å…¶ä»–é¢†åŸŸ
}

// âŒ é”™è¯¯ï¼šç›´æ¥ç›¸äº’ä¾èµ–
// libs/domain/iam/src/user â†’ libs/domain/notification/src/email
// libs/domain/notification/src/email â†’ libs/domain/iam/src/user
```

---

## ğŸ”§ å¼€å‘å·¥ä½œæµ

### æ–°å¢å­é¢†åŸŸçš„æ­¥éª¤

#### 1. åˆ›å»ºé¢†åŸŸæ¨¡å—

```bash
# åˆ›å»ºæ–°é¢†åŸŸç›®å½•
mkdir -p libs/domain/new-domain/src/{subdomain1,subdomain2}

# å¤åˆ¶æ¨¡æ¿é…ç½®
cp libs/domain/iam/package.json libs/domain/new-domain/
cp libs/domain/iam/tsconfig.json libs/domain/new-domain/
cp libs/domain/iam/.swcrc libs/domain/new-domain/

# æ›´æ–°åŒ…åå’Œä¾èµ–
```

#### 2. åˆ›å»ºå­é¢†åŸŸç»“æ„

```bash
# ä¸ºæ¯ä¸ªå­é¢†åŸŸåˆ›å»ºå››å±‚æ¶æ„
for subdomain in subdomain1 subdomain2; do
  mkdir -p libs/domain/new-domain/src/$subdomain/{domain,application,presentation}
  mkdir -p libs/domain/new-domain/src/$subdomain/domain/{entities,value-objects,events,services,repositories}
  mkdir -p libs/domain/new-domain/src/$subdomain/application/{use-cases,commands,queries,handlers,dtos}
  mkdir -p libs/domain/new-domain/src/$subdomain/presentation/controllers
done
```

#### 3. åˆ›å»ºåŸºç¡€è®¾æ–½æ”¯æŒ

```bash
# å¦‚æœéœ€è¦æ–°çš„åŸºç¡€è®¾æ–½æ¨¡å—
mkdir -p libs/infrastructure/new-infra/src
cp libs/infrastructure/cache/package.json libs/infrastructure/new-infra/
cp libs/infrastructure/cache/tsconfig.json libs/infrastructure/new-infra/
cp libs/infrastructure/cache/.swcrc libs/infrastructure/new-infra/
```

#### 4. é›†æˆåˆ°ä¸»åº”ç”¨

```typescript
// apps/api/src/new-domain/new-domain.module.ts
import { Module } from '@nestjs/common';
import { NewDomainModule } from '@aiofix/domain-new-domain';

@Module({
  imports: [NewDomainModule],
})
export class AppNewDomainModule {}

// apps/api/src/app.module.ts
@Module({
  imports: [
    // ... existing modules
    AppNewDomainModule,
  ],
})
export class AppModule {}
```

### å¼€å‘æœ€ä½³å®è·µ

#### 1. ä»£ç ç»„ç»‡

```typescript
// âœ… å¥½çš„å®è·µï¼šæ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ
// libs/domain/iam/src/user/domain/entities/user.entity.ts
import { BaseEntity } from '@aiofix/domain-shared';
import { Username } from '../value-objects/username.vo';

export class User extends BaseEntity {
  constructor(private readonly _username: Username) {
    super();
  }

  // å……è¡€æ¨¡å‹ï¼šåŒ…å«ä¸šåŠ¡é€»è¾‘
  changeUsername(newUsername: Username): void {
    if (this._username.equals(newUsername)) {
      throw new DomainException('Username is the same');
    }
    this._username = newUsername;
    this.addDomainEvent(new UsernameChangedEvent(this.id, newUsername));
  }
}
```

#### 2. æµ‹è¯•ç»„ç»‡

```typescript
// tests/unit/domain/iam/user/entities/user.entity.spec.ts
describe('User Entity', () => {
  describe('changeUsername', () => {
    it('should change username and emit event', () => {
      // Given
      const user = new User(Username.create('oldname'));
      const newUsername = Username.create('newname');

      // When
      user.changeUsername(newUsername);

      // Then
      expect(user.username.value).toBe('newname');
      expect(user.domainEvents).toHaveLength(1);
      expect(user.domainEvents[0]).toBeInstanceOf(UsernameChangedEvent);
    });
  });
});
```

#### 3. æ¨¡å—å¯¼å‡º

```typescript
// libs/domain/iam/src/index.ts
// å…¬å…±API - åªå¯¼å‡ºå¿…è¦çš„æ¥å£
export * from './user/domain/entities/user.entity';
export * from './user/domain/value-objects/username.vo';
export * from './user/domain/repositories/user-repository.interface';
export * from './user/application/use-cases/create-user.use-case';

// libs/domain/iam/src/user/index.ts
// å­é¢†åŸŸå†…éƒ¨å¯¼å‡º
export * from './domain';
export * from './application';
export * from './presentation';
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•å±‚æ¬¡

```
ğŸ“Š E2E Tests (apps/api/test/e2e/)
    â†‘ æµ‹è¯•
ğŸ’¼ Integration Tests (apps/api/test/integration/)
    â†‘ æµ‹è¯•
ğŸ§  Unit Tests (libs/domain/*/src/**/*.spec.ts)
```

### æµ‹è¯•ç»„ç»‡

```
test/
â”œâ”€â”€ unit/                          # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ domain/                    # é¢†åŸŸå±‚æµ‹è¯•
â”‚   â”‚   â””â”€â”€ iam/
â”‚   â”‚       â”œâ”€â”€ user/
â”‚   â”‚       â”œâ”€â”€ tenant/
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ infrastructure/            # åŸºç¡€è®¾æ–½æµ‹è¯•
â”‚       â”œâ”€â”€ cache/
â”‚       â”œâ”€â”€ database/
â”‚       â””â”€â”€ ...
â”œâ”€â”€ integration/                   # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ user-workflow.spec.ts
â”‚   â”œâ”€â”€ auth-flow.spec.ts
â”‚   â””â”€â”€ ...
â””â”€â”€ e2e/                          # ç«¯åˆ°ç«¯æµ‹è¯•
    â”œâ”€â”€ auth.e2e-spec.ts
    â”œâ”€â”€ user-management.e2e-spec.ts
    â””â”€â”€ ...
```

### æµ‹è¯•éš”ç¦»

```typescript
// é¢†åŸŸå±‚æµ‹è¯• - çº¯ä¸šåŠ¡é€»è¾‘ï¼Œæ— å¤–éƒ¨ä¾èµ–
describe('User Domain', () => {
  it('should create user with valid data', () => {
    const user = User.create({
      username: Username.create('john'),
      email: Email.create('john@example.com'),
    });

    expect(user.username.value).toBe('john');
  });
});

// åº”ç”¨å±‚æµ‹è¯• - æ¨¡æ‹ŸåŸºç¡€è®¾æ–½ä¾èµ–
describe('CreateUserUseCase', () => {
  let useCase: CreateUserUseCase;
  let mockUserRepository: jest.Mocked<UserRepository>;

  beforeEach(() => {
    mockUserRepository = {
      save: jest.fn(),
      findById: jest.fn(),
    };
    useCase = new CreateUserUseCase(mockUserRepository);
  });

  it('should create user successfully', async () => {
    await useCase.execute({ username: 'john', email: 'john@example.com' });

    expect(mockUserRepository.save).toHaveBeenCalledTimes(1);
  });
});
```

---

## ğŸ“ˆ æ€§èƒ½ä¸æ‰©å±•

### æ„å»ºä¼˜åŒ–

```json
{
  "scripts": {
    "build": "turbo run build",
    "build:api": "turbo run build --filter=@aiofix/api",
    "build:domain": "turbo run build --filter=@aiofix/domain-*",
    "build:infra": "turbo run build --filter=@aiofix/infrastructure-*"
  }
}
```

### å¼€å‘æ•ˆç‡

```typescript
// turbo.json - å¹¶è¡Œæ„å»ºä¼˜åŒ–
{
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "test": {
      "dependsOn": ["build"],
      "outputs": []
    }
  }
}
```

### è¿è¡Œæ—¶ä¼˜åŒ–

```typescript
// apps/api/src/main.ts
import { NestFactory } from '@nestjs/core';
import {
  FastifyAdapter,
  NestFastifyApplication,
} from '@nestjs/platform-fastify';

/**
 * @function bootstrap
 * @description
 * å¯åŠ¨NestJSåº”ç”¨çš„ä¸»å‡½æ•°ã€‚è¯¥å‡½æ•°è´Ÿè´£åˆ›å»ºåŸºäºFastifyå¹³å°çš„åº”ç”¨å®ä¾‹ï¼Œ
 * å¹¶ç›‘å¬æŒ‡å®šç«¯å£å¯åŠ¨é«˜æ€§èƒ½HTTPæœåŠ¡ã€‚
 *
 * ä¸»è¦åŸç†ä¸æœºåˆ¶å¦‚ä¸‹ï¼š
 * 1. é€šè¿‡NestFactory.createåˆ›å»ºåº”ç”¨å®ä¾‹ï¼Œä½¿ç”¨FastifyAdapterä½œä¸ºHTTPé€‚é…å™¨ï¼Œ
 *    Fastifyæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„Node.js webæ¡†æ¶ï¼Œç›¸æ¯”Expresså…·æœ‰æ›´å¥½çš„æ€§èƒ½è¡¨ç°ã€‚
 * 2. FastifyAdapteræä¾›äº†Fastifyä¸NestJSçš„é›†æˆï¼Œä½¿å¾—NestJSå¯ä»¥å……åˆ†åˆ©ç”¨
 *    Fastifyçš„é«˜æ€§èƒ½ç‰¹æ€§ï¼Œå¦‚æ›´å¿«çš„è·¯ç”±åŒ¹é…ã€æ›´ä½çš„å»¶è¿Ÿç­‰ã€‚
 * 3. æœ€åé€šè¿‡listenæ–¹æ³•ç›‘å¬ç¯å¢ƒå˜é‡PORTæŒ‡å®šçš„ç«¯å£ï¼ˆé»˜è®¤3000ï¼‰ï¼Œå¯åŠ¨HTTPæœåŠ¡ã€‚
 *
 * åŠŸèƒ½ä¸ä¸šåŠ¡è§„åˆ™ï¼š
 * 1. å¯åŠ¨å•ä½“åº”ç”¨æœåŠ¡å™¨
 * 2. é›†æˆæ‰€æœ‰é¢†åŸŸæ¨¡å—
 * 3. æä¾›ç»Ÿä¸€çš„APIå…¥å£
 * @returns {Promise<void>} è¿”å›ä¸€ä¸ªPromiseï¼Œè¡¨ç¤ºåº”ç”¨å¯åŠ¨è¿‡ç¨‹
 */
async function bootstrap(): Promise<void> {
  // åˆ›å»ºåŸºäºFastifyçš„Neståº”ç”¨å®ä¾‹ï¼Œåˆ©ç”¨Fastifyçš„é«˜æ€§èƒ½ç‰¹æ€§
  const app = await NestFactory.create<NestFastifyApplication>(
    AppModule,
    new FastifyAdapter(),
  );

  // å¯åŠ¨HTTPæœåŠ¡ï¼Œç›‘å¬æŒ‡å®šç«¯å£
  await app.listen(process.env.PORT ?? 3000, '0.0.0.0');
}

// å¯åŠ¨åº”ç”¨
bootstrap();
```

---

## ğŸ¯ æ€»ç»“

### æ¶æ„ä¼˜åŠ¿

1. **ğŸ¯ ä¸šåŠ¡é©±åŠ¨**: ä»¥å­é¢†åŸŸä¸ºæ ¸å¿ƒçš„ä»£ç ç»„ç»‡ï¼Œä¸šåŠ¡è¾¹ç•Œæ¸…æ™°
2. **ğŸ›ï¸ åˆ†å±‚æ¸…æ™°**: ä¸¥æ ¼çš„Clean Architectureåˆ†å±‚ï¼Œä¾èµ–å…³ç³»æ˜ç¡®
3. **ğŸ“¦ æ¨¡å—åŒ–**: é«˜å†…èšä½è€¦åˆçš„æ¨¡å—è®¾è®¡ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
4. **ğŸš€ æ¼”è¿›èƒ½åŠ›**: ä»å•ä½“åˆ°å¾®æœåŠ¡çš„å¹³æ»‘æ¼”è¿›è·¯å¾„

### å¼€å‘æ•ˆç‡

1. **âš¡ å¿«é€Ÿå¯åŠ¨**: å•ä½“åº”ç”¨çš„ç®€å•éƒ¨ç½²å’Œè°ƒè¯•
2. **ğŸ”§ ç»Ÿä¸€å·¥å…·**: ç»Ÿä¸€çš„æ„å»ºå·¥å…·å’Œå¼€å‘ç¯å¢ƒ
3. **ğŸ“Š å¹¶è¡Œå¼€å‘**: æŒ‰é¢†åŸŸåˆ†å·¥ï¼Œå›¢é˜Ÿå¹¶è¡Œå¼€å‘
4. **ğŸ§ª æµ‹è¯•å®Œå¤‡**: å®Œæ•´çš„æµ‹è¯•ç­–ç•¥å’Œå·¥å…·é“¾

### æœªæ¥æ‰©å±•

1. **ğŸŒ å¾®æœåŠ¡åŒ–**: åŸºäºé¢†åŸŸè¾¹ç•Œçš„è‡ªç„¶æ‹†åˆ†
2. **â˜ï¸ äº‘åŸç”Ÿ**: å®¹å™¨åŒ–éƒ¨ç½²å’ŒKubernetesç¼–æ’
3. **ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–**: åŸºäºç›‘æ§æ•°æ®çš„æŒç»­ä¼˜åŒ–
4. **ğŸ”„ æŠ€æœ¯æ¼”è¿›**: æ”¯æŒæ–°æŠ€æœ¯æ ˆçš„æ¸è¿›å¼å¼•å…¥

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

æœ¬æ–‡æ¡£ä¸ä»¥ä¸‹æ¶æ„æ–‡æ¡£æ„æˆå®Œæ•´ä½“ç³»ï¼š

1. **[01-iam-business-requirements.md](./01-iam-business-requirements.md)** - ä¸šåŠ¡éœ€æ±‚é©±åŠ¨
2. **[02-saas-platform-domain-division.md](./02-saas-platform-domain-division.md)** - é¢†åŸŸè¾¹ç•Œåˆ’åˆ†
3. **[03-hybrid-architecture-overview.md](./03-hybrid-architecture-overview.md)** - æ¶æ„è®¾è®¡æ€»è§ˆ
4. **[05-shared-layer-development-guide.md](./05-shared-layer-development-guide.md)** - å…±äº«å±‚å®ç°
5. **[06-domain-layer-development-guide.md](./06-domain-layer-development-guide.md)** - é¢†åŸŸå±‚å®ç°
6. **[07-application-layer-development-guide.md](./07-application-layer-development-guide.md)** - åº”ç”¨å±‚å®ç°
7. **[08-infrastructure-layer-development-guide.md](./08-infrastructure-layer-development-guide.md)** - åŸºç¡€è®¾æ–½å±‚å®ç°
8. **[09-presentation-layer-development-guide.md](./09-presentation-layer-development-guide.md)** - è¡¨ç°å±‚å®ç°

---

_æœ¬æ–‡æ¡£è¯¦ç»†é˜è¿°äº†é¡¹ç›®ä»£ç ç»„ç»‡æ¶æ„çš„è®¾è®¡ç†å¿µã€å®æ–½ç­–ç•¥å’Œæ¼”è¿›è·¯å¾„ï¼Œä¸ºå›¢é˜Ÿæä¾›äº†ä»å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡æ¶æ„çš„å®Œæ•´æŒ‡å¯¼æ–¹æ¡ˆã€‚_
