# æ—¥å¿—ç®¡ç†è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **æ–‡æ¡£ç±»å‹**: æ—¥å¿—ç®¡ç†æŠ€æœ¯è®¾è®¡æ–‡æ¡£
- **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2024å¹´12æœˆ
- **æ–‡æ¡£çŠ¶æ€**: è®¾è®¡ç‰ˆ
- **ç›®æ ‡è¯»è€…**: æ¶æ„å¸ˆã€æŠ€æœ¯è´Ÿè´£äººã€å¼€å‘å›¢é˜Ÿã€è¿ç»´å·¥ç¨‹å¸ˆ

---

## ğŸ¯ è®¾è®¡ç›®æ ‡

### æ¶æ„æ„¿æ™¯

æ„å»ºä¸€ä¸ªé«˜æ€§èƒ½ã€å¯æ‰©å±•çš„æ—¥å¿—ç®¡ç†ç³»ç»Ÿï¼Œä¸ºæ•´ä¸ªSaaSå¹³å°æä¾›ç»Ÿä¸€çš„æ—¥å¿—æœåŠ¡ï¼Œå®ç°ï¼š

- **é«˜æ€§èƒ½æ—¥å¿—**: åŸºäºPinoçš„é«˜æ€§èƒ½ç»“æ„åŒ–æ—¥å¿—è®°å½•
- **å¤šç§Ÿæˆ·éš”ç¦»**: æ”¯æŒå¤šç§Ÿæˆ·ã€å¤šç»„ç»‡ã€å¤šéƒ¨é—¨çš„æ—¥å¿—éš”ç¦»
- **å®Œæ•´è¿½è¸ª**: æä¾›è¯·æ±‚è¿½è¸ªã€æ–¹æ³•è¿½è¸ªã€é”™è¯¯è¿½è¸ª
- **æ™ºèƒ½åˆ†æ**: æ”¯æŒæ—¥å¿—èšåˆã€åˆ†æå’Œç›‘æ§
- **å¼€å‘å‹å¥½**: æä¾›å£°æ˜å¼æ—¥å¿—è£…é¥°å™¨å’ŒAOPæ”¯æŒ
- **è¿ç»´æ”¯æŒ**: æä¾›æ—¥å¿—æ”¶é›†ã€å­˜å‚¨ã€æŸ¥è¯¢å’Œåˆ†æèƒ½åŠ›

### è®¾è®¡åŸåˆ™

1. **é«˜æ€§èƒ½**: åŸºäºPinoçš„é«˜æ€§èƒ½æ—¥å¿—è®°å½•ï¼Œæœ€å°åŒ–å¯¹åº”ç”¨æ€§èƒ½çš„å½±å“
2. **ç»“æ„åŒ–**: æä¾›ç»“æ„åŒ–çš„JSONæ—¥å¿—è¾“å‡ºï¼Œä¾¿äºåˆ†æå’Œå¤„ç†
3. **ä¸Šä¸‹æ–‡è¿½è¸ª**: æ”¯æŒè¯·æ±‚ä¸Šä¸‹æ–‡ã€ç§Ÿæˆ·ä¸Šä¸‹æ–‡ã€ç”¨æˆ·ä¸Šä¸‹æ–‡è¿½è¸ª
4. **å¤šçº§æ—¥å¿—**: æ”¯æŒä¸åŒçº§åˆ«çš„æ—¥å¿—è®°å½•å’Œè¿‡æ»¤
5. **å®‰å…¨å¯é **: æ•æ„Ÿä¿¡æ¯è¿‡æ»¤ã€æ—¥å¿—å®Œæ•´æ€§ä¿è¯
6. **å¯æ‰©å±•æ€§**: æ”¯æŒå¤šç§æ—¥å¿—ä¼ è¾“å’Œå­˜å‚¨æ–¹æ¡ˆ

### æŠ€æœ¯ç›®æ ‡

- æ”¯æŒé«˜å¹¶å‘çš„æ—¥å¿—è®°å½•
- æä¾›å®Œæ•´çš„è¯·æ±‚è¿½è¸ªèƒ½åŠ›
- å®ç°æ™ºèƒ½æ—¥å¿—èšåˆå’Œåˆ†æ
- æ”¯æŒå¤šç§æ—¥å¿—ä¼ è¾“æ–¹æ¡ˆ
- ç¡®ä¿æ—¥å¿—æ•°æ®å®Œæ•´æ€§å’Œå®‰å…¨æ€§
- æä¾›å®Œå–„çš„ç›‘æ§å’Œè¿ç»´èƒ½åŠ›

---

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application Layer)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ æ—¥å¿—è£…é¥°å™¨  â”‚ â”‚ æ—¥å¿—æ‹¦æˆªå™¨  â”‚ â”‚ æ—¥å¿—æœåŠ¡    â”‚            â”‚
â”‚  â”‚ (Decorators)â”‚ â”‚ (Interceptors)â”‚ â”‚ (Services)  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  æ—¥å¿—ç®¡ç†å±‚ (Logging Management Layer)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ æ—¥å¿—ç®¡ç†å™¨  â”‚ â”‚ æ—¥å¿—èšåˆ    â”‚ â”‚ æ—¥å¿—åˆ†æ    â”‚            â”‚
â”‚  â”‚ (Manager)   â”‚ â”‚ (Aggregation)â”‚ â”‚ (Analytics) â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  æ—¥å¿—æœåŠ¡å±‚ (Logging Service Layer)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Pinoæ—¥å¿—    â”‚ â”‚ æ—¥å¿—ä¼ è¾“    â”‚ â”‚ æ—¥å¿—å­˜å‚¨    â”‚            â”‚
â”‚  â”‚ (Pino)      â”‚ â”‚ (Transport) â”‚ â”‚ (Storage)   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ æ–‡ä»¶ç³»ç»Ÿ    â”‚ â”‚ æ¶ˆæ¯é˜Ÿåˆ—    â”‚ â”‚ ç›‘æ§ç³»ç»Ÿ    â”‚            â”‚
â”‚  â”‚ (File System)â”‚ â”‚ (Message Q) â”‚ â”‚ (Monitoring) â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ—¥å¿—æµç¨‹æ¶æ„

```
åº”ç”¨è¯·æ±‚ â†’ æ—¥å¿—ä¸­é—´ä»¶ â†’ æ—¥å¿—æ‹¦æˆªå™¨ â†’ æ—¥å¿—æœåŠ¡ â†’ æ—¥å¿—ä¼ è¾“ â†’ æ—¥å¿—å­˜å‚¨
    â†“         â†“           â†“           â†“         â†“         â†“
è¯·æ±‚è¿½è¸ª   ä¸Šä¸‹æ–‡æå–   æ–¹æ³•è¿½è¸ª    æ—¥å¿—è®°å½•   æ ¼å¼è½¬æ¢   æŒä¹…åŒ–
    â†“         â†“           â†“           â†“         â†“         â†“
å“åº”è®°å½•   æ€§èƒ½ç›‘æ§    é”™è¯¯è¿½è¸ª    æ—¥å¿—èšåˆ   ä¼ è¾“åˆ†å‘   æŸ¥è¯¢åˆ†æ
```

### å¤šç§Ÿæˆ·æ—¥å¿—éš”ç¦»

```
ç§Ÿæˆ·Aæ—¥å¿—ç©ºé—´
â”œâ”€â”€ è¯·æ±‚æ—¥å¿— (tenant:A:request:*)
â”œâ”€â”€ ä¸šåŠ¡æ—¥å¿— (tenant:A:business:*)
â”œâ”€â”€ é”™è¯¯æ—¥å¿— (tenant:A:error:*)
â””â”€â”€ æ€§èƒ½æ—¥å¿— (tenant:A:performance:*)

ç§Ÿæˆ·Bæ—¥å¿—ç©ºé—´
â”œâ”€â”€ è¯·æ±‚æ—¥å¿— (tenant:B:request:*)
â”œâ”€â”€ ä¸šåŠ¡æ—¥å¿— (tenant:B:business:*)
â”œâ”€â”€ é”™è¯¯æ—¥å¿— (tenant:B:error:*)
â””â”€â”€ æ€§èƒ½æ—¥å¿— (tenant:B:performance:*)
```

---

## ğŸ”„ æ¶æ„æ¨¡å¼è¯´æ˜

### 1. ä¸­é—´ä»¶æ¨¡å¼

- **èŒè´£**: å¤„ç†HTTPè¯·æ±‚å’Œå“åº”çš„æ—¥å¿—è®°å½•
- **ç‰¹ç‚¹**:
  - è‡ªåŠ¨ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€ID
  - è®°å½•è¯·æ±‚å¼€å§‹å’Œç»“æŸæ—¶é—´
  - è®¡ç®—è¯·æ±‚å¤„ç†æ—¶é—´
  - æ”¯æŒç§Ÿæˆ·å’Œç”¨æˆ·è¿½è¸ª
- **ä¼˜åŠ¿**: è‡ªåŠ¨åŒ–æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ã€é”™è¯¯è¿½è¸ª

### 2. æ‹¦æˆªå™¨æ¨¡å¼

- **èŒè´£**: å¤„ç†æ–¹æ³•è°ƒç”¨çš„æ—¥å¿—è®°å½•
- **ç‰¹ç‚¹**:
  - è®°å½•æ–¹æ³•è°ƒç”¨çš„å¼€å§‹å’Œç»“æŸ
  - è®¡ç®—æ–¹æ³•æ‰§è¡Œæ—¶é—´
  - è®°å½•æ–¹æ³•å‚æ•°å’Œè¿”å›å€¼
  - æ”¯æŒå¼‚å¸¸æ•è·å’Œè®°å½•
- **ä¼˜åŠ¿**: æ–¹æ³•çº§è¿½è¸ªã€æ€§èƒ½åˆ†æã€è°ƒè¯•æ”¯æŒ

### 3. å·¥å‚æ¨¡å¼

- **èŒè´£**: åˆ›å»ºå’Œé…ç½®æ—¥å¿—å™¨å®ä¾‹
- **ç‰¹ç‚¹**:
  - æ ¹æ®é…ç½®åˆ›å»ºPinoå®ä¾‹
  - é…ç½®ä¼ è¾“å™¨å’Œæ ¼å¼åŒ–å™¨
  - å¤„ç†ä¸åŒç¯å¢ƒçš„é…ç½®å·®å¼‚
  - æä¾›ç»Ÿä¸€çš„åˆ›å»ºæ¥å£
- **ä¼˜åŠ¿**: é…ç½®çµæ´»ã€ç¯å¢ƒé€‚é…ã€ç»Ÿä¸€ç®¡ç†

### 4. è£…é¥°å™¨æ¨¡å¼

- **èŒè´£**: æä¾›å£°æ˜å¼æ—¥å¿—è®°å½•
- **ç‰¹ç‚¹**:
  - æ—¥å¿—çº§åˆ«è£…é¥°å™¨
  - æ—¥å¿—ä¸Šä¸‹æ–‡è£…é¥°å™¨
  - æ€§èƒ½ç›‘æ§è£…é¥°å™¨
  - é”™è¯¯è¿½è¸ªè£…é¥°å™¨
- **ä¼˜åŠ¿**: å¼€å‘å‹å¥½ã€ä»£ç ç®€æ´ã€æ˜“äºç»´æŠ¤

### 5. ä¼ è¾“æ¨¡å¼

- **èŒè´£**: å¤„ç†æ—¥å¿—çš„ä¼ è¾“å’Œå­˜å‚¨
- **ç‰¹ç‚¹**:
  - æ”¯æŒå¤šç§ä¼ è¾“ç›®æ ‡
  - å¼‚æ­¥ä¼ è¾“å¤„ç†
  - å¤±è´¥é‡è¯•æœºåˆ¶
  - æ‰¹é‡ä¼ è¾“ä¼˜åŒ–
- **ä¼˜åŠ¿**: ä¼ è¾“å¯é ã€æ€§èƒ½ä¼˜åŒ–ã€æ‰©å±•æ€§å¼º

---

## ğŸ“¦ æŠ€æœ¯æ ˆé€‰æ‹©

### åç«¯æŠ€æœ¯æ ˆ

- **æ—¥å¿—æ¡†æ¶**: Pino (Node.jsé«˜æ€§èƒ½æ—¥å¿—åº“)
- **ä¼ è¾“æ–¹æ¡ˆ**:
  - æ–‡ä»¶ä¼ è¾“: æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
  - ç½‘ç»œä¼ è¾“: HTTP/HTTPSã€TCP/UDP
  - æ¶ˆæ¯é˜Ÿåˆ—: Redisã€RabbitMQã€Kafka
- **å­˜å‚¨æ–¹æ¡ˆ**:
  - æœ¬åœ°å­˜å‚¨: æ–‡ä»¶ç³»ç»Ÿ
  - åˆ†å¸ƒå¼å­˜å‚¨: Elasticsearchã€MongoDB
  - äº‘å­˜å‚¨: AWS S3ã€é˜¿é‡Œäº‘OSS
- **ç›‘æ§**: Prometheus + Grafana
- **é…ç½®ç®¡ç†**: @nestjs/config

### å¼€å‘å·¥å…·

- **ç‰ˆæœ¬æ§åˆ¶**: Git
- **æµ‹è¯•æ¡†æ¶**: Jest
- **ä»£ç è§„èŒƒ**: ESLint + Prettier
- **æ–‡æ¡£ç”Ÿæˆ**: TypeDoc
- **å®¹å™¨åŒ–**: Docker + Docker Compose

---

## ğŸ¯ æ¶æ„å†³ç­–è®°å½• (ADR)

### ADR-001: Pinoæ—¥å¿—æ¡†æ¶é€‰æ‹©

- **çŠ¶æ€**: å·²æ¥å—
- **èƒŒæ™¯**: éœ€è¦é«˜æ€§èƒ½çš„Node.jsæ—¥å¿—è§£å†³æ–¹æ¡ˆ
- **å†³ç­–**: é€‰æ‹©Pinoä½œä¸ºæ ¸å¿ƒæ—¥å¿—æ¡†æ¶
- **å½±å“**:
  - æä¾›æé«˜çš„æ—¥å¿—æ€§èƒ½
  - æ”¯æŒç»“æ„åŒ–JSONè¾“å‡º
  - å…·å¤‡ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿ

### ADR-002: ç»“æ„åŒ–æ—¥å¿—è®¾è®¡

- **çŠ¶æ€**: å·²æ¥å—
- **èƒŒæ™¯**: éœ€è¦ä¾¿äºåˆ†æå’Œå¤„ç†çš„æ—¥å¿—æ ¼å¼
- **å†³ç­–**: é‡‡ç”¨JSONç»“æ„åŒ–æ—¥å¿—æ ¼å¼
- **å½±å“**:
  - ä¾¿äºæ—¥å¿—åˆ†æå’Œå¤„ç†
  - æ”¯æŒå¤æ‚çš„æŸ¥è¯¢å’Œè¿‡æ»¤
  - æé«˜æ—¥å¿—å¤„ç†æ•ˆç‡

### ADR-003: å¤šç§Ÿæˆ·æ—¥å¿—éš”ç¦»è®¾è®¡

- **çŠ¶æ€**: å·²æ¥å—
- **èƒŒæ™¯**: éœ€è¦æ”¯æŒå¤šç§Ÿæˆ·çš„æ—¥å¿—éš”ç¦»
- **å†³ç­–**: é‡‡ç”¨å‘½åç©ºé—´éš”ç¦»çš„æ—¥å¿—è®¾è®¡
- **å½±å“**:
  - æ”¯æŒå¤šç§Ÿæˆ·æ•°æ®éš”ç¦»
  - ä¾¿äºç§Ÿæˆ·çº§æ—¥å¿—ç®¡ç†
  - æé«˜æ—¥å¿—å®‰å…¨æ€§

### ADR-004: è¯·æ±‚è¿½è¸ªè®¾è®¡

- **çŠ¶æ€**: å·²æ¥å—
- **èƒŒæ™¯**: éœ€è¦å®Œæ•´çš„è¯·æ±‚è¿½è¸ªèƒ½åŠ›
- **å†³ç­–**: é‡‡ç”¨è¯·æ±‚IDå’Œä¸Šä¸‹æ–‡ä¼ é€’çš„è¿½è¸ªæœºåˆ¶
- **å½±å“**:
  - æä¾›å®Œæ•´çš„è¯·æ±‚é“¾è·¯è¿½è¸ª
  - æ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿè¿½è¸ª
  - ä¾¿äºé—®é¢˜å®šä½å’Œè°ƒè¯•

---

## ğŸ”§ æŠ€æœ¯å®ç°è¯¦è§£

### 1. æ—¥å¿—æ¨¡å—è®¾è®¡

#### æ¨¡å—ç»“æ„

```typescript
// æ—¥å¿—æ¨¡å—ä¸»æ–‡ä»¶
@Global()
@Module({
  imports: [
    // äº‹ä»¶å‘å°„å™¨æ¨¡å—ï¼Œç”¨äºæ—¥å¿—äº‹ä»¶å‘å¸ƒ
    EventEmitterModule.forRoot(),
    // ä¸Šä¸‹æ–‡æœ¬åœ°å­˜å‚¨æ¨¡å—ï¼Œç”¨äºè¯·æ±‚ä¸Šä¸‹æ–‡ç®¡ç†
    ClsModule.forRoot({
      global: true,
      middleware: {
        mount: true,
        setup: (cls, req) => {
          // è®¾ç½®è¯·æ±‚ä¸Šä¸‹æ–‡
          cls.set(
            'requestId',
            req.headers['x-request-id'] || cls.get('requestId'),
          );
          cls.set(
            'tenantId',
            req.headers['x-tenant-id'] || cls.get('tenantId'),
          );
          cls.set('userId', req.headers['x-user-id'] || cls.get('userId'));
          cls.set(
            'sessionId',
            req.headers['x-session-id'] || cls.get('sessionId'),
          );
        },
      },
    }),
  ],
  providers: [
    // æ—¥å¿—é…ç½®æœåŠ¡
    PinoLoggerConfigService,
    // æ—¥å¿—å·¥å‚
    PinoLoggerFactory,
    // ä¸»æ—¥å¿—æœåŠ¡
    PinoLoggerService,
    // æ—¥å¿—ä¸­é—´ä»¶
    PinoLoggingMiddleware,
    // æ—¥å¿—æ‹¦æˆªå™¨
    PinoLoggingInterceptor,
  ],
  exports: [
    // å¯¼å‡ºæ—¥å¿—æœåŠ¡ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨
    PinoLoggerService,
    PinoLoggerConfigService,
    PinoLoggerFactory,
    // å¯¼å‡ºä¸­é—´ä»¶å’Œæ‹¦æˆªå™¨
    PinoLoggingMiddleware,
    PinoLoggingInterceptor,
  ],
})
export class LoggingModule {}
```

### 2. æ—¥å¿—æœåŠ¡æ¥å£è®¾è®¡

#### æ ¸å¿ƒæ¥å£å®šä¹‰

```typescript
/**
 * @interface ILoggerService
 * @description æ—¥å¿—æœåŠ¡æ¥å£
 */
export interface ILoggerService {
  /**
   * @method debug
   * @description è®°å½•è°ƒè¯•æ—¥å¿—
   * @param message æ—¥å¿—æ¶ˆæ¯
   * @param context æ—¥å¿—ä¸Šä¸‹æ–‡
   * @param metadata æ—¥å¿—å…ƒæ•°æ®
   * @param error é”™è¯¯å¯¹è±¡
   */
  debug(
    message: string,
    context?: LogContext,
    metadata?: LogMetadata,
    error?: Error,
  ): void;

  /**
   * @method info
   * @description è®°å½•ä¿¡æ¯æ—¥å¿—
   * @param message æ—¥å¿—æ¶ˆæ¯
   * @param context æ—¥å¿—ä¸Šä¸‹æ–‡
   * @param metadata æ—¥å¿—å…ƒæ•°æ®
   * @param error é”™è¯¯å¯¹è±¡
   */
  info(
    message: string,
    context?: LogContext,
    metadata?: LogMetadata,
    error?: Error,
  ): void;

  /**
   * @method warn
   * @description è®°å½•è­¦å‘Šæ—¥å¿—
   * @param message æ—¥å¿—æ¶ˆæ¯
   * @param context æ—¥å¿—ä¸Šä¸‹æ–‡
   * @param metadata æ—¥å¿—å…ƒæ•°æ®
   * @param error é”™è¯¯å¯¹è±¡
   */
  warn(
    message: string,
    context?: LogContext,
    metadata?: LogMetadata,
    error?: Error,
  ): void;

  /**
   * @method error
   * @description è®°å½•é”™è¯¯æ—¥å¿—
   * @param message æ—¥å¿—æ¶ˆæ¯
   * @param context æ—¥å¿—ä¸Šä¸‹æ–‡
   * @param metadata æ—¥å¿—å…ƒæ•°æ®
   * @param error é”™è¯¯å¯¹è±¡
   */
  error(
    message: string,
    context?: LogContext,
    metadata?: LogMetadata,
    error?: Error,
  ): void;

  /**
   * @method fatal
   * @description è®°å½•è‡´å‘½é”™è¯¯æ—¥å¿—
   * @param message æ—¥å¿—æ¶ˆæ¯
   * @param context æ—¥å¿—ä¸Šä¸‹æ–‡
   * @param metadata æ—¥å¿—å…ƒæ•°æ®
   * @param error é”™è¯¯å¯¹è±¡
   */
  fatal(
    message: string,
    context?: LogContext,
    metadata?: LogMetadata,
    error?: Error,
  ): void;

  /**
   * @method createChildLogger
   * @description åˆ›å»ºå­æ—¥å¿—å™¨
   * @param context å­æ—¥å¿—å™¨ä¸Šä¸‹æ–‡
   * @returns å­æ—¥å¿—å™¨å®ä¾‹
   */
  createChildLogger(context: Record<string, any>): ILoggerService;

  /**
   * @method getStats
   * @description è·å–æ—¥å¿—ç»Ÿè®¡ä¿¡æ¯
   * @returns æ—¥å¿—ç»Ÿè®¡ä¿¡æ¯
   */
  getStats(): Promise<LogStats>;
}
```

### 3. Pinoæ—¥å¿—æœåŠ¡å®ç°

#### æœåŠ¡æ ¸å¿ƒåŠŸèƒ½

```typescript
/**
 * @class PinoLoggerService
 * @description åŸºäºPinoçš„æ—¥å¿—æœåŠ¡å®ç°
 */
@Injectable()
export class PinoLoggerService implements ILoggerService, OnModuleDestroy {
  private logger: pino.Logger;
  private stats: {
    totalLogs: number;
    logsByLevel: Record<LogLevel, number>;
    logsByContext: Record<LogContext, number>;
    totalLogSize: number;
    lastLogTime?: Date;
  };

  constructor(
    private readonly eventEmitter: EventEmitter2,
    private readonly configService: PinoLoggerConfigService,
    private readonly loggerFactory: PinoLoggerFactory,
    private readonly cls: ClsService,
  ) {
    this.initializeStats();
    this.initializeLogger();
  }

  /**
   * @method log
   * @description é€šç”¨æ—¥å¿—è®°å½•æ–¹æ³•
   */
  private log(
    level: LogLevel,
    message: string,
    context?: LogContext,
    metadata?: LogMetadata,
    error?: Error,
  ): void {
    // è·å–è¯·æ±‚ä¸Šä¸‹æ–‡
    const requestId = this.cls.get('requestId');
    const tenantId = this.cls.get('tenantId');
    const userId = this.cls.get('userId');
    const sessionId = this.cls.get('sessionId');

    // æ„å»ºæ—¥å¿—æ•°æ®
    const logData = {
      level,
      message,
      context: context || LogContext.SYSTEM,
      timestamp: new Date().toISOString(),
      requestId,
      tenantId,
      userId,
      sessionId,
      ...metadata,
    };

    // å¦‚æœæœ‰é”™è¯¯ï¼Œæ·»åŠ é”™è¯¯ä¿¡æ¯
    if (error) {
      logData.error = {
        name: error.name,
        message: error.message,
        stack: error.stack,
        code: (error as any).code,
      };
    }

    // è®°å½•æ—¥å¿—
    this.logger[level](logData);

    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    this.updateStats(level, context);

    // å‘å¸ƒæ—¥å¿—äº‹ä»¶
    this.eventEmitter.emit('log.recorded', logData);
  }

  /**
   * @method info
   * @description è®°å½•ä¿¡æ¯æ—¥å¿—
   */
  info(
    message: string,
    context?: LogContext,
    metadata?: LogMetadata,
    error?: Error,
  ): void {
    this.log('info', message, context, metadata, error);
  }

  /**
   * @method error
   * @description è®°å½•é”™è¯¯æ—¥å¿—
   */
  error(
    message: string,
    context?: LogContext,
    metadata?: LogMetadata,
    error?: Error,
  ): void {
    this.log('error', message, context, metadata, error);
  }

  /**
   * @method createChildLogger
   * @description åˆ›å»ºå­æ—¥å¿—å™¨
   */
  createChildLogger(context: Record<string, any>): ILoggerService {
    const childLogger = this.loggerFactory.createChildLogger(
      this.logger,
      context,
    );
    return new PinoLoggerService(
      this.eventEmitter,
      this.configService,
      this.loggerFactory,
      this.cls,
    );
  }
}
```

### 4. æ—¥å¿—ä¸­é—´ä»¶å®ç°

#### ä¸­é—´ä»¶è®¾è®¡

```typescript
/**
 * @class PinoLoggingMiddleware
 * @description Pinoæ—¥å¿—ä¸­é—´ä»¶
 */
@Injectable()
export class PinoLoggingMiddleware implements NestMiddleware {
  private readonly sensitiveHeaders = ['authorization', 'cookie', 'x-api-key'];
  private readonly sensitiveFields = ['password', 'token', 'secret'];

  constructor(private readonly logger: PinoLoggerService) {}

  /**
   * @method use
   * @description ä¸­é—´ä»¶ä¸»æ–¹æ³•
   */
  use(req: Request, res: Response, next: NextFunction): void {
    const startTime = Date.now();
    const requestId = this.generateRequestId();
    const tenantId = this.extractTenantId(req);
    const userId = this.extractUserId(req);

    // åˆ›å»ºè¯·æ±‚æ—¥å¿—æ•°æ®
    const requestLogData: RequestLogData = {
      requestId,
      method: req.method,
      url: req.url,
      userAgent: req.get('User-Agent'),
      ip: this.getClientIp(req),
      tenantId,
      userId,
      startTime,
      headers: this.sanitizeHeaders(req.headers),
      query: req.query,
      body: this.sanitizeBody(req.body),
    };

    // è®°å½•è¯·æ±‚å¼€å§‹æ—¥å¿—
    this.logRequest(requestLogData);

    // é‡å†™å“åº”æ–¹æ³•ä»¥æ•è·å“åº”æ•°æ®
    const originalSend = res.send;
    const originalJson = res.json;
    const originalEnd = res.end;

    let responseBody: any = null;
    let responseSize = 0;

    res.send = function (body: any): Response {
      responseBody = body;
      responseSize = Buffer.byteLength(body, 'utf8');
      return originalSend.call(this, body);
    };

    res.json = function (body: any): Response {
      responseBody = body;
      responseSize = Buffer.byteLength(JSON.stringify(body), 'utf8');
      return originalJson.call(this, body);
    };

    res.end = function (chunk?: any): Response {
      const endTime = Date.now();
      const duration = endTime - startTime;

      // åˆ›å»ºå“åº”æ—¥å¿—æ•°æ®
      const responseLogData: ResponseLogData = {
        ...requestLogData,
        statusCode: res.statusCode,
        duration,
        responseSize,
        responseBody: this.sanitizeResponse(responseBody),
      };

      // è®°å½•å“åº”æ—¥å¿—
      this.logResponse(responseLogData);

      return originalEnd.call(this, chunk);
    }.bind(this);

    next();
  }

  /**
   * @method logRequest
   * @description è®°å½•è¯·æ±‚æ—¥å¿—
   */
  private logRequest(data: RequestLogData): void {
    this.logger.info('HTTP Request', LogContext.HTTP_REQUEST, {
      requestId: data.requestId,
      method: data.method,
      url: data.url,
      userAgent: data.userAgent,
      ip: data.ip,
      tenantId: data.tenantId,
      userId: data.userId,
      headers: data.headers,
      query: data.query,
      body: data.body,
    });
  }

  /**
   * @method logResponse
   * @description è®°å½•å“åº”æ—¥å¿—
   */
  private logResponse(data: ResponseLogData): void {
    const level = data.statusCode >= 400 ? 'error' : 'info';
    this.logger[level]('HTTP Response', LogContext.HTTP_REQUEST, {
      requestId: data.requestId,
      method: data.method,
      url: data.url,
      statusCode: data.statusCode,
      duration: data.duration,
      responseSize: data.responseSize,
      tenantId: data.tenantId,
      userId: data.userId,
      responseBody: data.responseBody,
    });
  }
}
```

### 5. æ—¥å¿—æ‹¦æˆªå™¨å®ç°

#### æ‹¦æˆªå™¨è®¾è®¡

```typescript
/**
 * @class PinoLoggingInterceptor
 * @description Pinoæ—¥å¿—æ‹¦æˆªå™¨
 */
@Injectable()
export class PinoLoggingInterceptor implements NestInterceptor {
  private readonly sensitiveParameters = [
    'password',
    'token',
    'secret',
    'apikey',
    'api_key',
    'api-key',
  ];

  constructor(private readonly logger: PinoLoggerService) {}

  /**
   * @method intercept
   * @description æ‹¦æˆªå™¨ä¸»æ–¹æ³•
   */
  intercept(context: ExecutionContext, next: CallHandler): Observable<any> {
    const startTime = Date.now();
    const methodId = this.generateMethodId();
    const request = context.switchToHttp().getRequest();

    // æå–ä¸Šä¸‹æ–‡ä¿¡æ¯
    const requestId = request?.requestId;
    const tenantId = request?.tenantId;
    const userId = request?.userId;

    // è·å–æ–¹æ³•ä¿¡æ¯
    const handler = context.getHandler();
    const className = context.getClass().name;
    const methodName = handler.name;

    // è·å–æ–¹æ³•å‚æ•°
    const parameters = this.extractParameters(context);

    // åˆ›å»ºæ–¹æ³•æ—¥å¿—æ•°æ®
    const methodLogData: MethodLogData = {
      methodId,
      className,
      methodName,
      startTime,
      requestId,
      tenantId,
      userId,
      parameters: this.sanitizeParameters(parameters),
    };

    // è®°å½•æ–¹æ³•å¼€å§‹æ—¥å¿—
    this.logMethodStart(methodLogData);

    return next.handle().pipe(
      tap(result => {
        const endTime = Date.now();
        const duration = endTime - startTime;

        // è®°å½•æ–¹æ³•æˆåŠŸæ—¥å¿—
        this.logMethodSuccess({
          ...methodLogData,
          result: this.sanitizeResult(result),
          duration,
        });
      }),
      catchError(error => {
        const endTime = Date.now();
        const duration = endTime - startTime;

        // è®°å½•æ–¹æ³•é”™è¯¯æ—¥å¿—
        this.logMethodError({
          ...methodLogData,
          error,
          duration,
        });

        return throwError(() => error);
      }),
    );
  }

  /**
   * @method logMethodStart
   * @description è®°å½•æ–¹æ³•å¼€å§‹æ—¥å¿—
   */
  private logMethodStart(data: MethodLogData): void {
    this.logger.debug('Method Start', LogContext.BUSINESS, {
      methodId: data.methodId,
      className: data.className,
      methodName: data.methodName,
      requestId: data.requestId,
      tenantId: data.tenantId,
      userId: data.userId,
      parameters: data.parameters,
    });
  }

  /**
   * @method logMethodSuccess
   * @description è®°å½•æ–¹æ³•æˆåŠŸæ—¥å¿—
   */
  private logMethodSuccess(
    data: MethodLogData & { result: any; duration: number },
  ): void {
    this.logger.debug('Method Success', LogContext.BUSINESS, {
      methodId: data.methodId,
      className: data.className,
      methodName: data.methodName,
      requestId: data.requestId,
      tenantId: data.tenantId,
      userId: data.userId,
      result: data.result,
      duration: data.duration,
    });
  }

  /**
   * @method logMethodError
   * @description è®°å½•æ–¹æ³•é”™è¯¯æ—¥å¿—
   */
  private logMethodError(
    data: MethodLogData & { error: Error; duration: number },
  ): void {
    this.logger.error('Method Error', LogContext.BUSINESS, {
      methodId: data.methodId,
      className: data.className,
      methodName: data.methodName,
      requestId: data.requestId,
      tenantId: data.tenantId,
      userId: data.userId,
      error: data.error,
      duration: data.duration,
    });
  }
}
```

### 6. æ—¥å¿—å·¥å‚å®ç°

#### å·¥å‚è®¾è®¡

```typescript
/**
 * @class PinoLoggerFactory
 * @description Pinoæ—¥å¿—å™¨å·¥å‚
 */
@Injectable()
export class PinoLoggerFactory {
  constructor(private readonly configService: PinoLoggerConfigService) {}

  /**
   * @method createLogger
   * @description åˆ›å»ºPinoæ—¥å¿—å™¨å®ä¾‹
   */
  createLogger(): pino.Logger {
    const config = this.configService.getConfig();
    const pinoOptions = this.buildPinoOptions(config);
    return pino(pinoOptions);
  }

  /**
   * @method createChildLogger
   * @description åˆ›å»ºå­æ—¥å¿—å™¨
   */
  createChildLogger(
    parentLogger: pino.Logger,
    childOptions: Record<string, any>,
  ): pino.Logger {
    return parentLogger.child(childOptions);
  }

  /**
   * @private
   * @method buildPinoOptions
   * @description æ„å»ºPinoé…ç½®é€‰é¡¹
   */
  private buildPinoOptions(config: LogConfig): pino.LoggerOptions {
    const pinoOptions: pino.LoggerOptions = {
      level: config.level,
      timestamp: config.timestamp ? pino.stdTimeFunctions.isoTime : false,
    };

    // é…ç½®ä¼ è¾“å™¨
    this.configureTransport(pinoOptions, config);

    // é…ç½®æ ¼å¼åŒ–å™¨
    this.configureFormatter(pinoOptions, config);

    return pinoOptions;
  }

  /**
   * @private
   * @method configureTransport
   * @description é…ç½®ä¼ è¾“å™¨
   */
  private configureTransport(
    pinoOptions: pino.LoggerOptions,
    config: LogConfig,
  ): void {
    // åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨pino-prettyè¿›è¡Œæ ¼å¼åŒ–
    if (this.configService.shouldUsePrettyFormat()) {
      pinoOptions.transport = {
        target: 'pino-pretty',
        options: {
          colorize: config.colorize,
          translateTime: 'SYS:standard',
          ignore: 'pid,hostname',
        },
      };
    }

    // é…ç½®æ–‡ä»¶ä¼ è¾“
    if (config.filePath) {
      pinoOptions.transport = {
        target: 'pino/file',
        options: {
          destination: config.filePath,
          mkdir: true,
        },
      };
    }

    // é…ç½®è¿œç¨‹ä¼ è¾“
    if (config.remote) {
      pinoOptions.transport = {
        target: 'pino-http-send',
        options: {
          destination: config.remote.url,
          headers: {
            Authorization: `Bearer ${config.remote.token}`,
          },
          timeout: config.remote.timeout,
          retries: config.remote.retries,
        },
      };
    }
  }
}
```

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºæœ¬æ—¥å¿—ä½¿ç”¨

#### æœåŠ¡ç±»æ—¥å¿—è®°å½•

```typescript
/**
 * @class UserService
 * @description ç”¨æˆ·æœåŠ¡ç¤ºä¾‹
 */
@Injectable()
export class UserService {
  constructor(
    private readonly userRepository: IUserRepository,
    private readonly logger: PinoLoggerService,
  ) {}

  /**
   * @method createUser
   * @description åˆ›å»ºç”¨æˆ·ï¼ˆå¸¦æ—¥å¿—è®°å½•ï¼‰
   */
  async createUser(createUserDto: CreateUserDto): Promise<User> {
    this.logger.info('Creating user', LogContext.BUSINESS, {
      operation: 'create_user',
      resource: 'user',
      email: createUserDto.email,
    });

    try {
      const user = await this.userRepository.create(createUserDto);

      this.logger.info('User created successfully', LogContext.BUSINESS, {
        operation: 'create_user',
        resource: 'user',
        resourceId: user.id,
        email: user.email,
      });

      return user;
    } catch (error) {
      this.logger.error(
        'Failed to create user',
        LogContext.BUSINESS,
        {
          operation: 'create_user',
          resource: 'user',
          email: createUserDto.email,
        },
        error,
      );

      throw error;
    }
  }

  /**
   * @method getUserById
   * @description è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆå¸¦æ€§èƒ½ç›‘æ§ï¼‰
   */
  async getUserById(id: string): Promise<User> {
    const startTime = Date.now();

    this.logger.debug('Getting user by ID', LogContext.BUSINESS, {
      operation: 'get_user',
      resource: 'user',
      resourceId: id,
    });

    try {
      const user = await this.userRepository.findById(id);

      const duration = Date.now() - startTime;
      this.logger.debug('User retrieved successfully', LogContext.BUSINESS, {
        operation: 'get_user',
        resource: 'user',
        resourceId: id,
        duration,
      });

      return user;
    } catch (error) {
      const duration = Date.now() - startTime;
      this.logger.error(
        'Failed to get user',
        LogContext.BUSINESS,
        {
          operation: 'get_user',
          resource: 'user',
          resourceId: id,
          duration,
        },
        error,
      );

      throw error;
    }
  }
}
```

### 2. æ§åˆ¶å™¨æ—¥å¿—è®°å½•

#### APIæ§åˆ¶å™¨æ—¥å¿—

```typescript
/**
 * @class UserController
 * @description ç”¨æˆ·æ§åˆ¶å™¨ç¤ºä¾‹
 */
@Controller('api/v1/users')
export class UserController {
  constructor(
    private readonly userService: UserService,
    private readonly logger: PinoLoggerService,
  ) {}

  /**
   * @method createUser
   * @description åˆ›å»ºç”¨æˆ·API
   */
  @Post()
  async createUser(
    @Body() createUserDto: CreateUserDto,
  ): Promise<UserResponse> {
    this.logger.info('API: Creating user', LogContext.HTTP_REQUEST, {
      operation: 'api_create_user',
      resource: 'user',
      email: createUserDto.email,
    });

    const user = await this.userService.createUser(createUserDto);

    this.logger.info(
      'API: User created successfully',
      LogContext.HTTP_REQUEST,
      {
        operation: 'api_create_user',
        resource: 'user',
        resourceId: user.id,
        email: user.email,
      },
    );

    return this.toUserResponse(user);
  }

  /**
   * @method getUser
   * @description è·å–ç”¨æˆ·API
   */
  @Get(':id')
  async getUser(@Param('id') id: string): Promise<UserResponse> {
    this.logger.debug('API: Getting user', LogContext.HTTP_REQUEST, {
      operation: 'api_get_user',
      resource: 'user',
      resourceId: id,
    });

    const user = await this.userService.getUserById(id);

    this.logger.debug(
      'API: User retrieved successfully',
      LogContext.HTTP_REQUEST,
      {
        operation: 'api_get_user',
        resource: 'user',
        resourceId: id,
      },
    );

    return this.toUserResponse(user);
  }
}
```

### 3. è‡ªå®šä¹‰æ—¥å¿—ä¸Šä¸‹æ–‡

#### ä¸šåŠ¡ä¸Šä¸‹æ–‡æ—¥å¿—

```typescript
/**
 * @class OrderService
 * @description è®¢å•æœåŠ¡ç¤ºä¾‹
 */
@Injectable()
export class OrderService {
  constructor(
    private readonly orderRepository: IOrderRepository,
    private readonly logger: PinoLoggerService,
  ) {}

  /**
   * @method processOrder
   * @description å¤„ç†è®¢å•ï¼ˆå¸¦ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼‰
   */
  async processOrder(orderId: string, userId: string): Promise<Order> {
    // åˆ›å»ºä¸šåŠ¡ä¸Šä¸‹æ–‡æ—¥å¿—å™¨
    const businessLogger = this.logger.createChildLogger({
      businessContext: 'order_processing',
      orderId,
      userId,
    });

    businessLogger.info('Starting order processing', LogContext.BUSINESS, {
      operation: 'process_order',
      resource: 'order',
      resourceId: orderId,
      userId,
    });

    try {
      // è·å–è®¢å•
      const order = await this.orderRepository.findById(orderId);
      businessLogger.debug('Order retrieved', LogContext.BUSINESS, {
        operation: 'get_order',
        resource: 'order',
        resourceId: orderId,
        status: order.status,
      });

      // éªŒè¯è®¢å•
      await this.validateOrder(order);
      businessLogger.debug('Order validated', LogContext.BUSINESS, {
        operation: 'validate_order',
        resource: 'order',
        resourceId: orderId,
      });

      // å¤„ç†æ”¯ä»˜
      await this.processPayment(order);
      businessLogger.info('Payment processed', LogContext.BUSINESS, {
        operation: 'process_payment',
        resource: 'order',
        resourceId: orderId,
        amount: order.amount,
      });

      // æ›´æ–°è®¢å•çŠ¶æ€
      const updatedOrder = await this.orderRepository.update(orderId, {
        status: 'completed',
        processedAt: new Date(),
      });

      businessLogger.info('Order processing completed', LogContext.BUSINESS, {
        operation: 'complete_order',
        resource: 'order',
        resourceId: orderId,
        status: updatedOrder.status,
      });

      return updatedOrder;
    } catch (error) {
      businessLogger.error(
        'Order processing failed',
        LogContext.BUSINESS,
        {
          operation: 'process_order',
          resource: 'order',
          resourceId: orderId,
          userId,
        },
        error,
      );

      throw error;
    }
  }
}
```

---

## ğŸ“Š ç›‘æ§å’Œè¿ç»´

### 1. æ—¥å¿—æ€§èƒ½ç›‘æ§

#### ç›‘æ§æŒ‡æ ‡

```typescript
/**
 * @interface LogMetrics
 * @description æ—¥å¿—ç›‘æ§æŒ‡æ ‡
 */
export interface LogMetrics {
  // åŸºç¡€æŒ‡æ ‡
  totalLogs: number;
  logsByLevel: Record<LogLevel, number>;
  logsByContext: Record<LogContext, number>;

  // æ€§èƒ½æŒ‡æ ‡
  averageLogSize: number;
  totalLogSize: number;
  logsPerSecond: number;

  // é”™è¯¯æŒ‡æ ‡
  errorCount: number;
  errorRate: number;
  errorTypes: Record<string, number>;

  // ä¸šåŠ¡æŒ‡æ ‡
  tenantMetrics: Record<string, LogMetrics>;
  userMetrics: Record<string, LogMetrics>;

  // ç³»ç»ŸæŒ‡æ ‡
  memoryUsage: number;
  diskUsage: number;
  networkUsage: number;
}
```

### 2. æ—¥å¿—å¥åº·æ£€æŸ¥

#### å¥åº·æ£€æŸ¥å®ç°

```typescript
/**
 * @class LoggingHealthService
 * @description æ—¥å¿—å¥åº·æ£€æŸ¥æœåŠ¡
 */
@Injectable()
export class LoggingHealthService {
  constructor(
    private readonly logger: PinoLoggerService,
    private readonly configService: PinoLoggerConfigService,
  ) {}

  /**
   * @method checkHealth
   * @description æ£€æŸ¥æ—¥å¿—ç³»ç»Ÿå¥åº·çŠ¶æ€
   */
  async checkHealth(): Promise<LogHealth> {
    const startTime = Date.now();

    try {
      // æµ‹è¯•æ—¥å¿—è®°å½•
      const testMessage = 'Health check test';
      this.logger.info(testMessage, LogContext.SYSTEM, {
        operation: 'health_check',
        timestamp: new Date().toISOString(),
      });

      const responseTime = Date.now() - startTime;

      // è·å–æ—¥å¿—ç»Ÿè®¡
      const stats = await this.logger.getStats();

      return {
        healthy: true,
        connected: true,
        responseTime,
        stats,
        lastCheck: Date.now(),
      };
    } catch (error) {
      return {
        healthy: false,
        connected: false,
        responseTime: Date.now() - startTime,
        error: error.message,
        lastCheck: Date.now(),
      };
    }
  }
}
```

### 3. æ—¥å¿—èšåˆå’Œåˆ†æ

#### èšåˆæœåŠ¡å®ç°

```typescript
/**
 * @class LogAggregationService
 * @description æ—¥å¿—èšåˆæœåŠ¡
 */
@Injectable()
export class LogAggregationService {
  constructor(
    private readonly logger: PinoLoggerService,
    private readonly eventEmitter: EventEmitter2,
  ) {
    this.setupEventListeners();
  }

  /**
   * @method setupEventListeners
   * @description è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
   */
  private setupEventListeners(): void {
    // ç›‘å¬æ—¥å¿—è®°å½•äº‹ä»¶
    this.eventEmitter.on('log.recorded', logData => {
      this.processLogEntry(logData);
    });

    // ç›‘å¬é”™è¯¯æ—¥å¿—äº‹ä»¶
    this.eventEmitter.on('log.error', errorData => {
      this.processErrorLog(errorData);
    });
  }

  /**
   * @method processLogEntry
   * @description å¤„ç†æ—¥å¿—æ¡ç›®
   */
  private processLogEntry(logData: LogEntry): void {
    // æŒ‰ç§Ÿæˆ·èšåˆ
    if (logData.metadata.tenantId) {
      this.aggregateByTenant(logData);
    }

    // æŒ‰ç”¨æˆ·èšåˆ
    if (logData.metadata.userId) {
      this.aggregateByUser(logData);
    }

    // æŒ‰ä¸Šä¸‹æ–‡èšåˆ
    this.aggregateByContext(logData);

    // æŒ‰çº§åˆ«èšåˆ
    this.aggregateByLevel(logData);
  }

  /**
   * @method processErrorLog
   * @description å¤„ç†é”™è¯¯æ—¥å¿—
   */
  private processErrorLog(errorData: any): void {
    // é”™è¯¯ç»Ÿè®¡
    this.updateErrorStats(errorData);

    // é”™è¯¯å‘Šè­¦
    this.checkErrorThresholds(errorData);

    // é”™è¯¯æŠ¥å‘Š
    this.generateErrorReport(errorData);
  }
}
```

---

## ğŸš€ éƒ¨ç½²å’Œé…ç½®

### 1. Dockeré…ç½®

#### Docker Composeé…ç½®

```yaml
version: '3.8'

services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    container_name: logging-elasticsearch
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    ports:
      - '9200:9200'
    volumes:
      - elasticsearch-data:/usr/share/elasticsearch/data
    networks:
      - logging-network

  kibana:
    image: docker.elastic.co/kibana/kibana:8.11.0
    container_name: logging-kibana
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    ports:
      - '5601:5601'
    depends_on:
      - elasticsearch
    networks:
      - logging-network

  logstash:
    image: docker.elastic.co/logstash/logstash:8.11.0
    container_name: logging-logstash
    volumes:
      - ./logstash.conf:/usr/share/logstash/pipeline/logstash.conf
    ports:
      - '5044:5044'
    depends_on:
      - elasticsearch
    networks:
      - logging-network

  prometheus:
    image: prom/prometheus
    container_name: logging-prometheus
    ports:
      - '9090:9090'
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus-data:/prometheus
    networks:
      - logging-network

  grafana:
    image: grafana/grafana
    container_name: logging-grafana
    ports:
      - '3000:3000'
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana-data:/var/lib/grafana
    networks:
      - logging-network

volumes:
  elasticsearch-data:
  prometheus-data:
  grafana-data:

networks:
  logging-network:
    driver: bridge
```

### 2. ç¯å¢ƒå˜é‡é…ç½®

#### ç¯å¢ƒå˜é‡ç¤ºä¾‹

```bash
# æ—¥å¿—é…ç½®
LOG_LEVEL=info
LOG_FORMAT=json
LOG_COLORIZE=false
LOG_TIMESTAMP=true
LOG_REQUEST_ID=true
LOG_TENANT_ID=true
LOG_USER_ID=true
LOG_PERFORMANCE=true
LOG_STACK_TRACE=true

# æ—¥å¿—æ–‡ä»¶é…ç½®
LOG_FILE_PATH=/var/log/app/app.log
LOG_FILE_MAX_SIZE=100MB
LOG_FILE_MAX_FILES=10
LOG_FILE_INTERVAL=1d

# è¿œç¨‹æ—¥å¿—é…ç½®
LOG_REMOTE_URL=http://logstash:5044
LOG_REMOTE_TOKEN=your_token
LOG_REMOTE_TIMEOUT=5000
LOG_REMOTE_RETRIES=3

# Elasticsearché…ç½®
ELASTICSEARCH_URL=http://elasticsearch:9200
ELASTICSEARCH_INDEX=app-logs
ELASTICSEARCH_USERNAME=elastic
ELASTICSEARCH_PASSWORD=changeme

# ç›‘æ§é…ç½®
PROMETHEUS_URL=http://prometheus:9090
GRAFANA_URL=http://grafana:3000
```

---

## ğŸ“‹ æ€»ç»“

### ğŸ¯ æ—¥å¿—ç³»ç»Ÿæ ¸å¿ƒç‰¹æ€§

1. **é«˜æ€§èƒ½æ—¥å¿—è®°å½•**: åŸºäºPinoçš„é«˜æ€§èƒ½ç»“æ„åŒ–æ—¥å¿—
2. **å¤šç§Ÿæˆ·æ—¥å¿—éš”ç¦»**: æ”¯æŒå¤šç§Ÿæˆ·ã€å¤šç»„ç»‡ã€å¤šéƒ¨é—¨æ—¥å¿—éš”ç¦»
3. **å®Œæ•´è¯·æ±‚è¿½è¸ª**: è¯·æ±‚IDã€ä¸Šä¸‹æ–‡ä¼ é€’ã€é“¾è·¯è¿½è¸ª
4. **æ™ºèƒ½æ—¥å¿—èšåˆ**: æŒ‰ç§Ÿæˆ·ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ã€çº§åˆ«èšåˆ
5. **çµæ´»æ—¥å¿—ä¼ è¾“**: æ–‡ä»¶ã€ç½‘ç»œã€æ¶ˆæ¯é˜Ÿåˆ—å¤šç§ä¼ è¾“æ–¹æ¡ˆ
6. **å®Œå–„ç›‘æ§ä½“ç³»**: æ€§èƒ½ç›‘æ§ã€å¥åº·æ£€æŸ¥ã€ç»Ÿè®¡åˆ†æ
7. **å¼€å‘å‹å¥½**: è£…é¥°å™¨ã€æ‹¦æˆªå™¨ã€ä¸­é—´ä»¶æ”¯æŒ

### ğŸ”„ ä¸å…¶ä»–ç³»ç»Ÿçš„å…³ç³»

```
åº”ç”¨å±‚ â†’ æ—¥å¿—ç®¡ç†å±‚ â†’ æ—¥å¿—æœåŠ¡å±‚ â†’ åŸºç¡€è®¾æ–½å±‚
   â†“         â†“           â†“           â†“
ä¸šåŠ¡é€»è¾‘   æ—¥å¿—èšåˆ    æ—¥å¿—è®°å½•    å­˜å‚¨ä¼ è¾“
   â†“         â†“           â†“           â†“
æ€§èƒ½ç›‘æ§   æ™ºèƒ½åˆ†æ    æ•°æ®éš”ç¦»    é«˜å¯ç”¨æ€§
```

### ğŸ“š å¼€å‘æµç¨‹

1. **éœ€æ±‚åˆ†æ** â†’ ç¡®å®šæ—¥å¿—éœ€æ±‚å’Œæ€§èƒ½ç›®æ ‡
2. **æ¶æ„è®¾è®¡** â†’ è®¾è®¡æ—¥å¿—æ¶æ„å’Œä¼ è¾“æ–¹æ¡ˆ
3. **å®ç°å¼€å‘** â†’ å¼€å‘æ—¥å¿—æœåŠ¡å’Œä¸­é—´ä»¶
4. **æµ‹è¯•éªŒè¯** â†’ æ€§èƒ½æµ‹è¯•å’ŒåŠŸèƒ½éªŒè¯
5. **éƒ¨ç½²ä¸Šçº¿** â†’ å®¹å™¨åŒ–éƒ¨ç½²å’Œç›‘æ§é…ç½®
6. **è¿ç»´ç›‘æ§** â†’ æ—¥å¿—åˆ†æå’Œä¼˜åŒ–è°ƒæ•´

### ğŸš€ å¿«é€Ÿå¼€å§‹

1. é˜…è¯»æœ¬æ–‡æ¡£äº†è§£æ—¥å¿—ç³»ç»Ÿæ¶æ„
2. é…ç½®æ—¥å¿—ç¯å¢ƒå’Œç›¸å…³å‚æ•°
3. åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨æ—¥å¿—æœåŠ¡
4. é…ç½®ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ
5. æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´æ—¥å¿—ç­–ç•¥

---

**æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ `docs/architecture/tech-stack/` å’Œ `docs/architecture/development/` ä¸­çš„å…¶ä»–æ–‡æ¡£ä¿æŒä¸€è‡´ï¼Œè¯·ç»“åˆä½¿ç”¨ã€‚
